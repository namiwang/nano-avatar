Polymer({
  is: 'nano-avatar',
  properties: {

    /**
     * name
     * Abcd -> A
     * Abcd Efg -> AE
     * Abcd E Fg -> AF
     */
    name: {
      type: String,
      observer: '_nameChanged'
    },

    /**
     * The actual text in avatar. Generated by `name` or `email`.
     */
    text: {
      type: String,
      observer: '_textChanged'
    }
  },
  _nameChanged: function(name) {
    var parts;
    parts = name.split(' ').map(function(part) {
      return part[0].toUpperCase();
    });
    if (parts.length === 1) {
      return this.text = parts[0];
    } else {
      return this.text = parts.shift() + parts.pop();
    }
  },
  _textChanged: function(text) {
    var colors, name, options, styles, svg, svgData, textElement;
    colors = ["#1abc9c", "#16a085", "#f1c40f", "#f39c12", "#2ecc71", "#27ae60", "#e67e22", "#d35400", "#3498db", "#2980b9", "#e74c3c", "#c0392b", "#9b59b6", "#8e44ad", "#bdc3c7", "#34495e", "#2c3e50", "#95a5a6", "#7f8c8d", "#ec87bf", "#d870ad", "#f69785", "#9ba37e", "#b49255", "#b49255", "#a94136"];
    options = {
      height: 48,
      width: 48,
      fontSize: 20,
      fontWeight: 400,
      radius: 5
    };
    textElement = document.createElementNS('http://www.w3.org/2000/svg', 'text');
    textElement.innerHTML = this.text;
    textElement.setAttribute('x', '50%');
    textElement.setAttribute('y', '50%');
    textElement.setAttribute('dy', '0.35em');
    textElement.setAttribute('pointer-events', 'auto');
    textElement.setAttribute('fill', 'white');
    textElement.setAttribute('text-anchor', 'middle');
    textElement.style.fontSize = '20px';
    svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
    svg.setAttribute('pointerEvents', 'none');
    svg.setAttribute('width', 48);
    svg.setAttribute('height', 48);
    styles = {
      backgroundColor: colors[Math.floor(Math.random() * colors.length)],
      width: '48px',
      height: '48px',
      borderRadius: '5px'
    };
    for (name in styles) {
      svg.style[name] = styles[name];
    }
    svg.appendChild(textElement);
    svgData = window.btoa((new XMLSerializer).serializeToString(svg));
    return this.$.wrapper.setAttribute('src', 'data:image/svg+xml;base64,' + svgData);
  }
});
